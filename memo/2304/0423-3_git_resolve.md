실수로 api key 연습할때쓴걸 깃에 푸시해버려서

깃 가디언이 머지를 안해준다.

이걸 어떻게 해야하나?

일단 그냥 api key 재발급 받고 경고 무시함..

사실 이거때문이 아니라 그냥 충돌이 있어서 그런거였던 것 같음.

//

review

현 자산 정보를 블록체인에 통신해 가져온다..

는 기능을 구현했음.

1. 내가 미리 지정한 코인에 대한 정보만을 가져올 수 있음.

이건 어쩔 수 없다. 다만 코인을 뭐 수백개 가져올 것도 아니고,

기껏해야 스테이블 코인 2~3개, 메인 코인, 잡코인 2~3개 정도만 들고 있을텐데 뭐..

코인 수십개씩 들고 있을거 아니면 이게 효율적인 것 같음.

이건 쉽게 끝났다.

2. 인스턴스 만들기

이걸 할 떄 목표는 각 서비스와 체인마다 인스턴스를 만들되,

어플리케이션 구동 시점에서 한 번만 인스턴스들을 만든다는 거였음.

싱글톤이라고 했던가 이걸?

nestjs의 기능을 잘 이해하지 못한 상태여서 애를 좀 먹었지만,

express를 사용했으면 오히려 더 해매고 다녔을 것 같음.

//

우선 인스턴스의 파라미터가 되는

service와 network, key를 담은 config를 만들어주는게 필요했다.

nest는 헷갈리는게, 뭔 데이터나 함수같은걸 주려면 service 만들고 모듈 만들고 난리를 쳐야 함.

아무튼 나는 network, key 정보를 담은 config(상수)를 설정해 사용하고 싶었음.

이걸 위해서 ConfigModule, ConfigService를 사용해야 했고,

어떻게 사용하는지를 배웠다.

//

여기서 새로 나온게 provider,

새로운 상수같은 것들을 다른 모듈들에 전달해주기 위해 사용한다.

provider에서 custom config obj를 생성해주었다.

이 커스텀 환경 변수 (편의상 이렇게 부르기로 함)를

@Inject 데코레이터를 달고, 생성자 함수에 넣어주면 그 생성자 함수를 호출한 클래스 web3Provider에서

이 환경 변수를 사용할 수 있게 된다.

이렇게 가져온 환경변수를 뜯어 service, network, apikey를 읽고,

service-network : Alchemy/InfuraProvider instance

로 k-v 페어링되는 매핑들을 쭉 만들어줌.

이렇게 만든 애들은 일단 가지고 있고,

외부에서 이걸 key로 접근해 원하는 걸 가져올 수 있는 getProvider 함수를 따로 만들었다.

service, network만 알면 어떤 인스턴스를 사용할지 알 수 있으니 이 둘을 묶어 키로 사용한 것.

//

이렇게 만들어진 Web3Provider 인스턴스를 web3module로 가져와 provider attribute에 담고,

exports attirbute에도 담아 export 해 다른 곳에서도 접근할 수 있게 해준다.

//

원하는 모듈에서 이 모듈 (web3Module)을 가져오고,

대응하는 서비스에서도 web3Service를 가져와서 사용해주면 된다.

어떤 인스턴스를 사용할지는 이 service가 받은 변수로 결정된다.

그 후엔 뭐 함수 잘 짜주면 된다.

하고 나니 별거 아니네..

//

TODO

1. 각 ERC20 토큰 별 or network 별 decimal 가져오기

아마 체인 별로 contract의 decimal 설정값이 다른 것 같음.

decimal을 18로 고정하면 옵티미즘은 0.000000 얼마 나옴..

이게 체인 별로 다른건지 토큰 별로 다른건지 모르겠는데 아마 전자일 것 같음.

체인마다 토큰 규격은 거의 다 똑같이 쓰니까..

2. 체인의 메인 코인 정보 가져오기

이건 ethers에서 주는 함수가 있어서 금방 할듯

3. 실시간 가스비

이건 이더스캔을 쓰면 금방이긴 한데, 일단은 ethers 같은걸 사용해보자.

안되거나 빡치면 그냥 etherscan api 쓰는걸로 하겠음.

4. coin table 정규화

이게 더 쪼개지나?

싶었는데 억지로라도 쪼개던가 경량화 해야할 것 같다.

너무 구려..

token 이름 필드는 없애도 될 것 같은데..

5. 하나 더 있었는데 기억이 안나네..
